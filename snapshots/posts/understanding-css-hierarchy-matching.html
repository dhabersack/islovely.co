<html lang="en"><head><meta charset="utf-8"><meta name="description" content="In order to improve your stylesheets, you first need to understand how browsers match CSS-selectors and HTML."><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><title>Understanding CSS hierarchy-matching | islovely</title></head><body><header><a href="#!/">islovely</a><nav><ol><li><a href="#!/">Home</a></li><li><a href="#!/clients">Clients</a></li><li><a href="#!/pages/services">Services</a></li><li><a href="#!/pages/process">Process</a></li><li><a href="#!/pages/request-a-proposal">Request a proposal</a></li><li><a href="#!/pages/regarding-recruitment">Regarding recruitment</a></li><li><a href="#!/pages/about">About</a></li><li><a href="#!/posts">Posts</a></li><li><a href="#!/pages/contact">Contact</a></li></ol></nav></header><section><nav><a href="#!/posts">← Posts</a></nav><h1>Understanding CSS hierarchy-matching</h1><p>Published on December 27th, 2012.</p><p>To get a feel for how CSS-selectors should be written, you need to understand how browsers match them to the related markup. The following tries to give a top-level description that might not be entirely accurate but should still give you a good enough idea of how CSS and HTML get combined during rendering.</p><p><strong>Note:</strong> Writing this, I realized that this is probably not how it actually works, as using regular expressions to match selectors and hierarchies would obviate the need for repeated identification-cycles. Nevertheless, thinking of the process this way helps writing simpler selectors, so the model remains valid.</p><h3>Finding hierarchies</h3><p>Consider a site with the following markup:</p><pre><code>&lt;html&gt;  &lt;head&gt;    &lt;!-- omitted --&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;header&gt;      &lt;h1&gt;Site title&lt;/h1&gt;    &lt;/header&gt;    &lt;nav&gt;      &lt;ol&gt;        &lt;li&gt;          &lt;a href="#"&gt;Link&lt;/a&gt;        &lt;/li&gt;        &lt;li&gt;          &lt;a href="#"&gt;Link&lt;/a&gt;        &lt;/li&gt;      &lt;/ol&gt;    &lt;/nav&gt;    &lt;section&gt;      &lt;article&gt;        &lt;header&gt;          &lt;h2&gt;Article title&lt;/h2&gt;          &lt;p&gt;Date&lt;/p&gt;        &lt;/header&gt;        &lt;p&gt;Content&lt;/p&gt;        &lt;p&gt;Content with &lt;a href="#"&gt;link&lt;/a&gt;&lt;/p&gt;        &lt;ul&gt;          &lt;li&gt;            &lt;a href="#"&gt;Link&lt;/a&gt;          &lt;/li&gt;          &lt;li&gt;            &lt;a href="#"&gt;Link&lt;/a&gt;          &lt;/li&gt;        &lt;/ul&gt;      &lt;/article&gt;    &lt;/section&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><p>When discarding the content and chaining all tags together according to their nesting, the path to each tag can be extracted:</p><table><thead><tr><th>Tag</th><th>Hierarchy</th></tr></thead><tbody><tr><th>html</th><td>html</td></tr><tr><th>body</th><td>html body</td></tr><tr><th>header</th><td>html body header</td></tr><tr><th>h1</th><td>html body header h1</td></tr><tr><th>nav</th><td>html body nav</td></tr><tr><th>ol</th><td>html body nav ol</td></tr><tr><th>li</th><td>html body nav ol li</td></tr><tr><th>a</th><td>html body nav ol li a</td></tr><tr><th>li</th><td>html body nav ol li</td></tr><tr><th>a</th><td>html body nav ol li a</td></tr><tr><th>section</th><td>html body section</td></tr><tr><th>article</th><td>html body section article</td></tr><tr><th>header</th><td>html body section article header</td></tr><tr><th>h2</th><td>html body section article header h2</td></tr><tr><th>p</th><td>html body section article header p</td></tr><tr><th>p</th><td>html body section article p</td></tr><tr><th>p</th><td>html body section article p</td></tr><tr><th>a</th><td>html body section article p a</td></tr><tr><th>ul</th><td>html body section article ul</td></tr><tr><th>li</th><td>html body section article ul li</td></tr><tr><th>a</th><td>html body section article ul li a</td></tr><tr><th>li</th><td>html body section article ul li</td></tr><tr><th>a</th><td>html body section article ul li a</td></tr></tbody></table><p>Note that some tags share the same hierarchy.</p><p>While each hierarchy could be used as a (bad) CSS-selector, think of them as anattribute we add to each tag that we now match against selectors.</p><h3>Matching simple selectors</h3><p><strong>Selectors are matched to markup from right to left.</strong> Single-tag selectors are simplest and instruct the browser to ignore all elements whose hierarchy does not end in the exact tag given.</p><p>For example, matching the above table against the selector <code>li</code> would trim it down to just four elements:</p><table><thead><tr><th>Tag</th><th>Hierarchy</th></tr></thead><tbody><tr><th>li</th><td>html body nav ol <strong>li</strong></td></tr><tr><th>li</th><td>html body nav ol <strong>li</strong></td></tr><tr><th>li</th><td>html body section article ul <strong>li</strong></td></tr><tr><th>li</th><td>html body section article ul <strong>li</strong></td></tr></tbody></table><p>The browser only had to filter the initial table a single time to find these elements and can now apply the styles set with the selector.</p><h3>Matching multi-level selectors</h3><p>As soon as we chain selectors the browser has to iterate over intermediate results multiple times, potentially filtering them with every step.</p><p>When applying a rule such as <code>ul &gt; li</code>, the browser again starts at the rightmost tag and filters the hierarchy-table to end up with the same result as before:</p><table><thead><tr><th>Tag</th><th>Hierarchy</th></tr></thead><tbody><tr><th>li</th><td>html body nav ol <strong>li</strong></td></tr><tr><th>li</th><td>html body nav ol <strong>li</strong></td></tr><tr><th>li</th><td>html body section article ul <strong>li</strong></td></tr><tr><th>li</th><td>html body section article ul <strong>li</strong></td></tr></tbody></table><p>This list now gets filtered again to identify all <code>li</code>-tags nested <em>directly below</em> a <code>ul</code>-tag:</p><table><thead><tr><th>Tag</th><th>Hierarchy</th></tr></thead><tbody><tr><th>li</th><td>html body section article <strong>ul &gt; li</strong></td></tr><tr><th>li</th><td>html body section article <strong>ul &gt; li</strong></td></tr></tbody></table><p>The more levels there are in a selector, the more times each resulting list needs to be iterated over again.</p><p>While extending a selector will often result in a condensed list, unnecessary extensions generate wasted filtering-cycles. In the above example, adding <code>html &gt; body &gt; section &gt; article &gt;</code> in front of the selector would force the browser to filter the result <strong>four more times without altering the list</strong> before it could assert a match.</p><h3>Identification loops</h3><p>While every level adds a new iteration over a filtered list of potentially-matching tags, some selectors require a more complex analysis of a single element’s hierarchy. While the child-selector (<code>&gt;</code>) only requires a check of the direct parent tag, a descendant-selector (space) might force the browser to walk up the entire hierarchy trying to find a match.</p><p>For example, <code>nav a</code> first filters out all elements whose hierarchy does not end in an <code>a</code>-tag, resulting in the following list:</p><table><thead><tr><th>Tag</th><th>Hierarchy</th></tr></thead><tbody><tr><th>a</th><td>html body nav ol li <strong>a</strong></td></tr><tr><th>a</th><td>html body nav ol li <strong>a</strong></td></tr><tr><th>a</th><td>html body section article p <strong>a</strong></td></tr><tr><th>a</th><td>html body section article ul li <strong>a</strong></td></tr><tr><th>a</th><td>html body section article ul li <strong>a</strong></td></tr></tbody></table><p>When adding <code>nav</code> to the selector, the browser has to execute a more detailed analysis of each element’s hierarchy. For the first element, it has to go through the following steps:</p><table><thead><tr><th>Iteration</th><th>Hierarchy</th><th>Result</th></tr></thead><tbody><tr><th>1</th><td>html body nav ol <strong>li a</strong></td><td><code>nav</code> not found, continue…</td></tr><tr><th>2</th><td>html body nav <strong>ol</strong> li <strong>a</strong></td><td><code>nav</code> not found, continue…</td></tr><tr><th>3</th><td>html body <strong>nav</strong> ol li <strong>a</strong></td><td><code>nav</code> found, match</td></tr></tbody></table><p>The browser can stop walking up this element’s hierarchy as soon as a match is found and continue with the next element. In contrast to that, the last element from the initial list gets matched against <code>nav a</code> as follows:</p><table><thead><tr><th>Iteration</th><th>Hierarchy</th><th>Result</th></tr></thead><tbody><tr><th>1</th><td>html body section article ul <strong>li a</strong></td><td><code>nav</code> not found, continue…</td></tr><tr><th>2</th><td>html body section article <strong>ul</strong> li <strong>a</strong></td><td><code>nav</code> not found, continue…</td></tr><tr><th>3</th><td>html body section <strong>article</strong> ul li <strong>a</strong></td><td><code>nav</code> not found, continue…</td></tr><tr><th>4</th><td>html body <strong>section</strong> article ul li <strong>a</strong></td><td><code>nav</code> not found, continue…</td></tr><tr><th>5</th><td>html <strong>body</strong> section article ul li <strong>a</strong></td><td><code>nav</code> not found, continue…</td></tr><tr><th>6</th><td><strong>html</strong> body section article ul li <strong>a</strong></td><td><code>nav</code> not found, no match</td></tr></tbody></table><p>For elements that only match the end of a selector but not its beginning, the browser has to walk up the entire hierarchy before it can assess that the element definitely does not match.</p><p>In real-world examples, pages usually contain a much higher number of elements with deeper and more complex hierarchies. Since the matching-process has to be repeated for every element remaining after each filtering-step, it is best to <strong>keep nesting of markup to a minimum</strong> and <strong>use selectors that match or fail as quickly as possible</strong>.</p><p>You can read more recommendations on doing the latter in my post on <a href="/#/posts/writing-high-performance-css/">writing high-performance CSS</a>.</p></section><footer><p>Copyright © 2013<br>Dom Habersack, <a href="http://islovely.co/" title="Portfolio of Dom Habersack">islovely.co</a><br><a href="#!/pages/imprint">Imprint</a></p><ul><li><a href="http://github.com/dhabersack" title="dhabersack on GitHub">dhabersack</a></li><li><a href="http://twitter.com/dhabersack" title="@dhabersack on Twitter">@dhabersack</a></li><li><a href="http://xing.com/profiles/Dominik_Habersack" title="Dominik Habersack on XING">Dominik Habersack</a></li></ul></footer></body></html>